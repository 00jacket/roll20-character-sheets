<script type="text/worker">
	// Primary Stats
	var primaryStats = [ "courage", "intelligence", "charisme", "adresse", "force", "attaque", "parade"];
	// Secondary Stats
	var secondaryStats = [ "charismetotal", "intelligencetotal", "adressetotal", "forcetotal", "couragetotal",
						 "magiepsymod", "magiephymod", "resimagiemod", "fouillemod", "jetmod" ];
	var prStats = {
	    change: [ "repeating_armures:armureprphy", "repeating_armures:armureprmag", "prnat" ],
	    remove: [ "repeating_armures" ]
	};
	// items weight
	var weightStats = [ "couverturepoids", "tentepoids", "matelaspoids",
						"richesseberylium", "richessethritil", "boursescharge",
						"materielscharge", "butinscharge", "livrescharge", "bouffescharge", "charactercharge_max", "sacscharge_max"  ];
	// repeating items sections
	var weightSections = {
		change: [ "repeating_materiels:materielpoids", "repeating_butins:butinpoids", "repeating_bouffes:bouffepoids", "repeating_livres" ],
		remove: [ "repeating_materiels", "repeating_butins", "repeating_bouffes", "repeating_livres" ]
	};
	// max available weight
	var weightStats_max = {
	    change: [ "repeating_sacs:saccharge_max", "repeating_bourses:boursecharge_max" ],
	    remove: [ "repeating_sacs", "repeating_bourses" ]
	}
	
	var levelAndXP = [ 0, 100, 300, 600, 1000, 1500, 2100, 2800, 3600, 4500, 
					   5500, 6600, 7800, 9100, 10500, 12000, 13600, 15300, 17100, 19000,
					   21000, 24000, 29000, 35000, 45000, 60000 ];
	
	/*---------
	    EVENTS
	----------*/	
	// Primary Stats
    on( primaryStats.map( stat => `change:${stat} change:${stat}mod` ).join(" "), function(e) {
        updatePrimaryStat( e.sourceAttribute.replace( "mod", "" ) );
    });
	// Secondary Stats & Secondary Mods
	on( secondaryStats.map( stat => `change:${stat}` ).join(" "), function() {
	    updateSecondaryStats();
	});
	// PR Physique et magique
	on( prStats[ "change" ].map( stat => `change:${stat}` ).join(" ") + " " + prStats[ "remove" ].map( stat => `remove:${stat}` ).join(" "), function() {
		updatePR();
	});
	// Déplacement
	on("change:prphy change:forcetotal", function() {
	    updateDeplacement();
	});
	// Equive
	on("change:adressetotal change:prphy change:esquivemod change:charsurcharge", function() {
	    updateEsquive();
	});
	// Level
	on("change:characterlevel", function() {
		updateXP();
	});
	// Total golds
	on("change:richesseor change:richesseargent change:richessecuivre", function() {
	    updatePO();
	});
	// total repeating section weight
	on( weightSections[ "change" ].map( stat => `change:${stat}` ).join(" ") + " " + weightSections[ "remove" ].map( stat => `remove:${stat}` ).join(" "), function( e ) {
	    var section = e[ 'sourceAttribute' ].split('-')[0];
	    
	    if( section === "repeating_materiels_" ) {
	        updateRSSum( "repeating_materiels", "materielpoids", "materielscharge" );
	    } else if( section === "repeating_butins_" ) {
	        updateRSSum( "repeating_butins", "butinpoids", "butinscharge" );
	    } else if( section === "repeating_bouffes_" ) {
	        updateRSSum( "repeating_bouffes", "bouffepoids", "bouffescharge" );
	    } else if( section === "repeating_livres_" ) {
	        updateLivresCharge();
	    }
	});
	// total weight
	on( weightStats.map( stat => `change:${stat}` ).join(" "), function() {
	    updateCharge();
	});
	// max available weight
	on( weightStats_max[ "change" ].map( stat => `change:${stat}` ).join(" ") + " " + weightStats_max[ "remove" ].map( stat => `remove:${stat}` ).join(" "), function( e ) {
	    var section = e[ 'sourceAttribute' ].split('-')[0];
	    
	    if( section === "repeating_sacs_" ) {
	        updateRSSum( "repeating_sacs", "saccharge_max", "sacscharge_max" );
	    } else if( section === "repeating_bourses_" ) {
	        updateRSSum( "repeating_bourses", "boursecharge_max", "boursescharge_max" );
	    }
	});
	// change magic school tab
	on("change:repeating_ecolesmagie:ecolemagieselected", function( e ) {
		if( e[ "sourceType"] === "player" ) { 
			updateMagicSchoolTab( e );
		}
	});
	// change magic school name
	on("change:tab_ecolemagie change:ecolemagieselectall change:tab_magielevel", function() {
		displayMagicSpells();
	});
	// register magie level and ecole
	on("change:repeating_magies", function() {
		changeSpellMagicSchool();
	});

	/*------------
	    FUNCTIONS
	-------------*/
	function safeInt( val ) { return parseInt( val, 10 ) || 0;	}
	
	function structSafeInt( v ) {
	    for( attr in v ) {
	        v[ attr ] = safeInt( v[ attr ] );
	    }
	    return v;
	}
	
	function updatePrimaryStat( attr ) {
	    getAttrs( [ attr, `${attr}mod` ], function( v ) {
            setAttrs({
                [ `${attr}total` ]: safeInt( v[ attr ] ) + safeInt( v[ attr + "mod" ] )
            });
        });
	}
	
	function updateSecondaryStats() {
	   getAttrs( secondaryStats, function( sValues ) {
            var v = structSafeInt( sValues );
			var magiePsy = Math.ceil( ( v[ "intelligencetotal"] + v[ "charismetotal" ] ) / 2 );
			var magiePhy = Math.ceil( ( v[ "intelligencetotal"] + v[ "adressetotal" ] ) / 2 );
			var resiMagie = Math.ceil( ( v[ "intelligencetotal"] + v[ "couragetotal" ] + v[ "forcetotal" ] ) / 3 );
			
			var bonusIntel = " ";
			var bonusDegatsIntel = 0;
			var bonusAdresse = " ";
			var bonusForce = " ";
			var bonusDegatsForce = 0;
			
			if( v[ "intelligencetotal" ] > 12 ) {
				bonusIntel = "Pour chaque point d'Intelligence supérieur à 12 : +1 point de dégâts des sorts (selon sortilège).";
				bonusDegatsIntel = v[ "intelligencetotal" ] - 12;
			}
			
			if( v[ "adressetotal" ] > 12 ) {
				bonusAdresse = "Adresse supérieure à 12 : +1 à l'Attaque OU à la Parade (un seul point quel que soit le score).";
			} else if( v[ "adressetotal" ] <= 8 ) {
				bonusAdresse = "Adresse à 8 ou inférieur : -1 à l'Attaque OU à la Parade.";
			}
			
			if( v[ "forcetotal" ] > 12 ) {
				bonusForce = "Pour chaque point de Force supérieur à 12 : +1 Point d'Impact.";
				bonusDegatsForce = v[ "forcetotal" ] - 12;
			} else if( v[ "forcetotal" ] <= 8 ) {
				bonusForce = "Force de 8 ou inférieure : -1 Point d'Impact.";
				bonusDegatsForce = -1;
			}
		
			setAttrs({ 
				"magiepsy": magiePsy,			
				"magiepsytotal": magiePsy + v[ "magiepsymod" ],
				"magiephy": magiePhy,
				"magiephytotal": magiePhy + v[ "magiephymod" ],
				"resimagie": resiMagie,
				"resismagietotal": resiMagie + v[ "resimagiemod" ],
				"fouille": v[ "intelligencetotal"],
				"fouilletotal": v[ "intelligencetotal"] + v[ "fouillemod" ],
				"bonusintel": bonusIntel,
				"bonusdegatsintel": bonusDegatsIntel,
				"jet": v[ "adressetotal" ],
				"jettotal": v[ "adressetotal" ] + v[ "jetmod" ],			
				"bonusadresse": bonusAdresse,
				"bonusforce": bonusForce,
				"bonusdegatsforce": bonusDegatsForce
			});
		}); 
	}
	
	function updateDeplacement() {
		getAttrs( [ "forcetotal", "deplacementrapide", "deplacementrapideduree", "deplacementsprint", "deplacementsprintduree", "prphy" ], function( sValues ) {			
			var v = structSafeInt( sValues );
			var prPhy = v[ "prphy" ];
			var deplacementRapide = v[ "deplacementrapide" ];
			var deplacementRapideDuree = v[ "deplacementrapideduree" ];
			var deplacementSprint = v[ "deplacementsprint" ];
			var deplacementSprintDuree = v[ "deplacementsprintduree" ];
			
			// PR vs Déplacement
			if( prPhy === 0 || prPhy === 1 ) {
				deplacementRapide = 8;
				deplacementRapideDuree = v[ "forcetotal" ] * 20;
				deplacementSprint = 12;
				deplacementSprintDuree = v[ "forcetotal" ] * 5;
			} else if( prPhy === 2 ) {
				deplacementRapide = 6;
				deplacementRapideDuree = v[ "forcetotal" ] * 18;
				deplacementSprint = 10;
				deplacementSprintDuree = v[ "forcetotal" ] * 4;
			} else if( prPhy === 3 || prPhy === 4 ) {
				deplacementRapide = 4;
				deplacementRapideDuree = v[ "forcetotal" ] * 15;
				deplacementSprint = 8;
				deplacementSprintDuree = v[ "forcetotal" ] * 4;
			} else if( prPhy === 5 ) {
				deplacementRapide = 4;
				deplacementRapideDuree = v[ "forcetotal" ] * 10;
				deplacementSprint = 6;
				deplacementSprintDuree = v[ "forcetotal" ] * 3;
			} else if( prPhy === 6 ) {
				deplacementRapide = 3;
				deplacementRapideDuree = v[ "forcetotal" ] * 8;
				deplacementSprint = 4;
				deplacementSprintDuree = v[ "forcetotal" ] * 3;
			} else if( prPhy === 7 ) {
				deplacementRapide = 2;
				deplacementRapideDuree = v[ "forcetotal" ] * 7;
				deplacementSprint = 3;
				deplacementSprintDuree = v[ "forcetotal" ] * 2;
			} else if( prPhy > 7 ) {
				deplacementRapide = 1;
				deplacementRapideDuree = v[ "forcetotal" ] * 5;
				deplacementSprint = 2;
				deplacementSprintDuree = v[ "forcetotal" ] * 2;
			}
			
			setAttrs({
				"deplacementrapide": deplacementRapide,
				"deplacementrapideduree": deplacementRapideDuree,
				"deplacementsprint": deplacementSprint,
				"deplacementsprintDuree": deplacementSprintDuree
			}, { silent: true });	
		});	
	}
	
	function updateEsquive() {
		getAttrs( [ "adressetotal", "esquivemod", "prphy", "charsurcharge" ], function( sValues ) {			
			var v = structSafeInt( sValues );
			var esquive = v[ "adressetotal" ];
			var prPhy = v[ "prphy" ];
			var surcharge = v[ "charsurcharge" ];
			
			// PR vs Esquive
			if( prPhy === 0 || prPhy === 1 ) {
				esquive += 1;
			} else if( prPhy === 3 || prPhy === 4 ) {
				esquive += - 2;
			} else if( prPhy === 5 ) {
				esquive += -4;
			} else if( prPhy === 6 ) {
				esquive += - 5;
			} else if( prPhy === 7 ) {
				esquive += - 6;
			} else if( prPhy > 7 ) {
				esquive = 0;
			}
			
			// surcharge vs Esquive
			if( surcharge === 4  ) {
				esquive += -2;
			} else if( surcharge === 5 ) {
				esquive = 0;
			}
			
			setAttrs({
				"esquive": esquive,
				"esquivetotal": esquive + v[ "esquivemod" ]
			}, { silent: true });			
		});	
	}
	
	function updateXP() {
		getAttrs( [ "characterlevel" ], function( v ) {	
			var level = safeInt( v[ "characterlevel" ] );
			
			setAttrs({
				"characterexperience_max": safeInt( levelAndXP[ level ], { silent : true} )
			});	
		});
	}
	
	function updatePR() {	
	    var prPhy = 0;
		var prMag = 0;
		getSectionIDs( "repeating_armures", function(idarray) {
			getAttrs( [ "prnat", ...idarray.map(id => `repeating_armures_${id}_armureprphy`), ...idarray.map(id => `repeating_armures_${id}_armureprmag`) ], function( sValues ) {			
				var v = structSafeInt( sValues );
				
				for( var i in idarray) {
					prPhy += v[`repeating_armures_${idarray[i]}_armureprphy`];
					prMag += v[`repeating_armures_${idarray[i]}_armureprmag`];
				}
												
				setAttrs({
					"prphy": prPhy,
					"prmag": prMag,
					"pr": prPhy + prMag + v[ "prnat" ]
				});		
			});					
		});
	}
	
	function updatePO() {
	    getAttrs( ["richesseor","richesseargent","richessecuivre"], function( sValues ) {	
	        var v = structSafeInt( sValues );
			setAttrs({
				"boursescharge": v[ "richesseor" ] + v[ "richesseargent" ] + v[ "richessecuivre" ]			
			});
		});
	}
	
	function updateCharge() {
	    getAttrs( weightStats, function( sValues ) {	
			var v = structSafeInt( sValues );
			var boursesCharge = Math.floor( v[ "boursescharge" ] * 0.1 ) * 0.1;
			var lingotsCharge = ( Math.floor( v[ "richesseberylium" ] * 5 ) * 0.1 ) + ( Math.floor( v[ "richessethritil" ] * 3 ) * 0.1 );
			var bivouacCharge = v[ "couverturepoids" ] + v[ "tentepoids" ] + v[ "matelaspoids" ];
			var livresCharge = v[ "livrescharge" ] * 0.5;
			var matosCharge = v[ "materielscharge" ] + v[ "butinscharge" ] + v[ "bouffescharge" ];
			var sacsCharge = ( boursesCharge + lingotsCharge + bivouacCharge + matosCharge + livresCharge ).toFixed( 1 );
			
			// Charge vs Encombrement
			var charCharge_max = v["charactercharge_max" ];
			var sacsCharge_max= v[ "sacscharge_max" ];
			var percentCharge = Math.floor( sacsCharge * 100 / sacsCharge_max );
			var surcharge = 0;
			
			if( sacsCharge >= charCharge_max ) {				
				surcharge = 5; // Equipement très encombrant
			} else if( percentCharge >= 90 ) {
				surcharge = 4; // Sacs plein
			} else if( percentCharge >= 75 ) {
				surcharge = 3; // Sacs preque plein
			} else if( percentCharge >= 50 ) {
				surcharge = 2; // Sacs moitié plein
			} else if( percentCharge >= 25 ) {
				surcharge = 1; // Sacs pas trop plein
			} 
						
			setAttrs({
                "sacscharge": sacsCharge,
				"charsurcharge": surcharge
		    });
		});
	}

	function updateRSSum( section, attr, total ) {
		var sum = 0;
		getSectionIDs( section, function(idarray) { 
			getAttrs( [ ...idarray.map(id => `${section}_${id}_${attr}`) ], function( sValues ) {
			    var v = structSafeInt( sValues );
				for( var i in idarray ) {
					sum += v[`${section}_${idarray[i]}_${attr}`];
				}
				setAttrs({
                    [ total ]: sum
		        });
			});
		    
		});
	}
	
	function updateLivresCharge() {
	    getSectionIDs( 'repeating_livres', function(idarray) {
		    setAttrs({
                "livrescharge": safeInt( idarray.length )
		    });
		});
	}
	
	function updateMagicSchoolTab( eventInfo ) {
		var sTabs = {};
		var selected = "all";
		
		getSectionIDs( "repeating_ecolesmagie", function(idarray) { 			
			for( var i in idarray ) {
				 sTabs[ `repeating_ecolesmagie_${idarray[ i ]}_ecolemagieselected` ] = 0;
			}
			
			selected = eventInfo[ "sourceAttribute" ].split("_")[2];
			sTabs[ eventInfo[ "sourceAttribute" ] ] = 1;
			
			setAttrs( {"tab_ecolemagie": selected} );			
			setAttrs( sTabs, { silent: true } );
		});
	}
	
	function displayMagicSpells( eventInfo ) {		
		var sDisplay = {};
		
		getSectionIDs( "repeating_magies", function(idarray) {
			getAttrs( [ "tab_ecolemagie", "tab_niveaumagie", "ecolemagieselectall", 
						...idarray.map(id => `repeating_magies_${id}_magieecole`),
						...idarray.map(id => `repeating_magies_${id}_magieniveau`) ], function( v ) {
				var cur_ecole = v[ "tab_ecolemagie" ];
				var cur_level = v[ "tab_niveaumagie" ];
								
				for( var i in idarray ) {	
					if( ( v[ `repeating_magies_${idarray[ i ]}_magieecole` ] ===  cur_ecole && v[ `repeating_magies_${idarray[ i ]}_magieniveau` ] ===  cur_level ) || v[ "ecolemagieselectall" ] === "1" ) {
						sDisplay[ `repeating_magies_${idarray[ i ]}_magiefiltre` ] = 1;
					} else {
						sDisplay[ `repeating_magies_${idarray[ i ]}_magiefiltre` ] = 0;
					}
				}
				setAttrs( sDisplay, { silent: true } );
			});
		});
	}
	
	function changeSpellMagicSchool() {
			getAttrs( [ "tab_ecolemagie", "tab_niveaumagie"], function( v ) {
			setAttrs({
				"repeating_magies_magieecole": v[ "tab_ecolemagie" ],
				"repeating_magies_magieniveau": v[ "tab_niveaumagie" ],
				"repeating_magies_magiefiltre": 1
			}, { silent: true });
		});
	}

	
	
	/*----------------
	 Version handling
	----------------*/
	on("sheet:opened", function() {
		detect_version();
	});
	
	function detect_version() {
	    getAttrs( [ "version" ], function( v ) {
	        var vrs = parseFloat( v[ "version" ] ) || 1.0;
			console.log("Détection de la version : " + vrs );
	        if( vrs == 2.0 ) {
				// uptodate
				return;
			} else if( vrs < 2.0 ) {
			    getAttrs( [ "level", "valattaque", "valparade", "class", "race", "experience" ], function( v ) {
					if( v[ "level" ] != undefined || v[ "valattaque" ] != undefined || v[ "valparade" ] != undefined || v[ "class" ] != undefined || v[ "race" ] != undefined || v[ "experience" ] != undefined  ) {
						console.log( "Début du process d'import..." );
                        update_process();
					}
					console.log( "Mise à jour des statistiques primaires..." );
					for( i in primaryStats ) {
						updatePrimaryStat( primaryStats[ i ] );
					}
					console.log( "Mise à jour des statistiques secondaires..." );
					updateSecondaryStats();
					console.log( "Mise à jour de la version..." );
					setAttrs( { "version" : 2.0 } );
				});
			}
			console.log( "ok" );
		});
	}
	
	function update_process() {
		var _aNewAttr = [];
		var _aOldAttr = [];
		var _sNewValues = {};
		
		// sheet2.0 attr "Character"
		_aNewAttr = _aNewAttr.concat( [ "characterlevel","characterexperience","characterjobs","characterorigin","characterpointdestin","characterlangue" ] );
		_aOldAttr = _aOldAttr.concat( [ "level","experience","class","race","pointdestin","langue" ] );
		
		// Sheet2.0 attr "richesses"
		_aNewAttr = _aNewAttr.concat( [ "richesseor","richesseargent" ] );
		_aOldAttr = _aOldAttr.concat( [ "po","pa" ] );
		
		// sheet2.0 attr "Combat"
		_aNewAttr = _aNewAttr.concat( [ "ev_max","ea_max","Attaque","AttaqueMod","Parade","ParadeMod" ] );
		_aOldAttr = _aOldAttr.concat( [ "evmax","eamax","ValAttaque","ValAttaqueMod","ValParade","ValParadeMod" ] );
		
		// Sheet2.0 attr "arme"
		_aNewAttr = _aNewAttr.concat( [ "repeating_butins_rowID_butinNom","repeating_butins_rowID_butinNom","repeating_butins_rowID_butinNom","repeating_butins_rowID_butinNom" ] );
		_aOldAttr = _aOldAttr.concat( [ "arme01","arme02","arme03","arme04" ] );

		// Sheet2.0 attr "armures"
		_aNewAttr = _aNewAttr.concat( [ "repeating_armures_rowID_armurenom","repeating_armures_rowID_armurenom","repeating_armures_rowID_armurenom","repeating_armures_rowID_armurenom" ] );
		_aOldAttr = _aOldAttr.concat( [ "equip01","equip02","equip03","equip04" ] );

		// Sheet2.0 attr "Inventaire"
		_aNewAttr = _aNewAttr.concat( [ "repeating_materiels_rowID_materielnom","repeating_materiels_rowID_materielnom","repeating_materiels_rowID_materielnom","repeating_materiels_rowID_materielnom" ] );
		_aOldAttr = _aOldAttr.concat( [ "inv01","inv02","inv03","inv04" ] );

		// Sheet2.0 attr "Compétences"
		_aNewAttr = _aNewAttr.concat( [ "repeating_competences_rowID_competencenom","repeating_competences_rowID_competencenom","repeating_competences_rowID_competencenom","repeating_competences_rowID_competencenom" ] );
		_aOldAttr = _aOldAttr.concat( [ "raceability01","raceability02","raceability03","raceability04" ] );

		// Sheet2.0 attr "Compétences"
		_aNewAttr = _aNewAttr.concat( [ "repeating_competences_rowID_competencenom","repeating_competences_rowID_competencenom","repeating_competences_rowID_competencenom","repeating_competences_rowID_competencenom" ] );
		_aOldAttr = _aOldAttr.concat( [ "classability01","classability02","classability03","classability04" ] );
		
		// Get the old attr values
		getAttrs( _aOldAttr, function( v ) {
			// Each new attr take the value of the old attr
			for( var i in _aNewAttr ) {
				var _oldAttr = _aOldAttr[ i ];
				var _newAttr = _aNewAttr[ i ];
				var _oldValue = v[ _oldAttr ];
				
				if( _oldValue != undefined ) {
    				// If the new attr is a repeating row > get a rowId
    				if( _newAttr.indexOf( "_rowID_" ) !== -1 ) {
    					_newAttr = _newAttr.replace( "rowID", generateRowID() );
    				}
    				
    				_sNewValues[ _newAttr ] = _oldValue;
				}
			}
			// Update
			setAttrs( _sNewValues );
		});
		
		// old sheet sections attr to new sheet sections attr
		_sNewValues = {};
		var _aOldSections = [
		    {
				oldSection: "cac",
				newSection: "armes",
				oldAttr: [ "armenom", "armeat", "armeprd", "armedes", "armedegats" ],
				newAttr: [ "armenom", "armeat", "armeprd", "armedegats", "armedegats" ]
			},
			{
				oldSection: "arme",
				newSection: "butins",
				oldAttr: [ "armes" ],
				newAttr: [ "butinnom" ]
			}, 
			{
				oldSection: "equipement",
				newSection: "armures",
				oldAttr: [ "equipement" ],
				newAttr: [ "armurenom" ]
			},  
			{
				oldSection: "inventaire",
				newSection: "materiels",
				oldAttr: [ "inventaire" ],
				newAttr: [ "materielnom" ]
			},  
			{
				oldSection: "compin",
				newSection: "competences",
				oldAttr: [ "compin" ],
				newAttr: [ "competencenom" ]
			},  
			{
				oldSection: "classabilities",
				newSection: "competences",
				oldAttr: [ "classabilities" ],
				newAttr: [ "competencenom" ]
			},
			{
				oldSection: "spells",
				newSection: "magies",
				oldAttr: [ "sortnom_1","magietype","sortdesattaque_1","sortdesbonusattaque_1","sortdegatdes_1","sortdegatbonus_1","sortcout_1" ],
				newAttr: [ "magienom","magieepreuvelanceurjet","magieepreuvelanceurmod","magieepreuvelanceurmod","magiedegats","magiedegats","magiecout" ]
			},
			{
				oldSection: "spells",
				newSection: "magies",
				oldAttr: [ "creaturenom_1","invocbonus_1","invoccontrole_1","invocrevoc_1","invoccout_1" ],
				newAttr: [ "magienom","magieepreuveappelmod","magieepreuvecontrolmod","magieepreuverevocationmod","magiecout" ]
			}
		];
		
		for( var i in _aOldSections ) {
		    // Get Old section IDs
		    convertRS( _aOldSections[ i ] );
		}
	}
	
	function convertRS( sOldSections ) {
	    var _oldSection = "repeating_" + sOldSections[ "oldSection" ];
	    var _newSection = "repeating_" + sOldSections[ "newSection" ];
		var _aOldAttr = [];
	    
	    // get sections id of the old Section
        getSectionIDs( _oldSection, function( idarray ) {
		     if ( idarray.length > 0 ) {
		         _aOldAttr = [];
		         
		         // create an array with all attr combine with all ids of the section
		         for( var i_oldAttr in sOldSections[ "oldAttr" ] ) {
		             _oldAttr = sOldSections[ "oldAttr" ][ i_oldAttr ];
		            _aOldAttr.push( ...idarray.map(id => `${_oldSection}_${id}_${_oldAttr}`) );
		         }
		         
		         // get all values for a section
		         getAttrs( _aOldAttr, function (v) {
		             var _sNewValues = {}
		             for( var i_idarray in idarray ) {
		                 
		                 // Create new rows in new section
		                 var newrowid = generateRowID();
		                 var _oldSectionID = _oldSection + "_" + idarray[ i_idarray ] + "_";
		                 var _newSectionID = _newSection + "_" + newrowid + "_";
		                 
		                 for( var i_attr in sOldSections[ "newAttr" ] ) {
		                    // Each new attr take the value of the old attr
		                    var _oldAttr = _oldSectionID + sOldSections[ "oldAttr" ][ i_attr ];
            				var _newAttr = _newSectionID + sOldSections[ "newAttr" ][ i_attr ];
            				var _oldValue = v[ _oldAttr ];
            				
            				if( _oldValue != undefined ) {
            				    // exceptions
            				    if( sOldSections[ "oldAttr" ][ i_attr ] === "armedes" || sOldSections[ "oldAttr" ][ i_attr ] === "SortDesAttaque_1" || sOldSections[ "oldAttr" ][ i_attr ] === "SortDegatDes_1" ) {
            				        _sNewValues[ _newAttr ] = _oldValue + "d6";
            				    } else if( sOldSections[ "oldAttr" ][ i_attr ] === "armedegats" || sOldSections[ "oldAttr" ][ i_attr ] === "SortDesBonusAttaque_1" || sOldSections[ "oldAttr" ][ i_attr ] === "SortDegatBonus_1" ) {
            				        _sNewValues[ _newAttr ] = ( _sNewValues[ _newAttr ] || "1d6" ) + "+" + _oldValue;
            				    } else {
            				        _sNewValues[ _newAttr ] = _oldValue;
            				    }
            				}
		                 }
		             }		             
		             setAttrs( _sNewValues );
		         });
		     }
        });
	}
</script>
<!-- Version N# --->
<input type="hidden" name="attr_version" value="0">
<!-- AutoCalc fields for sheet worker--->
<input type="hidden" name="attr_CourageTotal" value="0" /> <!-- Courage + CourageMod -->
<input type="hidden" name="attr_IntelligenceTotal" value="0" /> <!-- Intelligence + IntelligenceMod -->
<input type="hidden" name="attr_BonusDegatsIntel" value="0" /> <!-- Force + ForceMod -->
<input type="hidden" name="attr_CharismeTotal" value="0" /> <!-- Charisme + CharismeMod -->
<input type="hidden" name="attr_AdresseTotal" value="0" /> <!-- Adresse + AdresseMod -->
<input type="hidden" name="attr_ForceTotal" value="0" /> <!-- Force + ForceMod -->
<input type="hidden" name="attr_BonusDegatsForce" value="0" /> <!-- Force + ForceMod -->
<input type="hidden" name="attr_AttaqueTotal" value="0" /> <!-- Attaque + AttaqueMod -->
<input type="hidden" name="attr_ParadeTotal" value="0" /> <!-- Parade + ParadeMod -->
<input type="hidden" name="attr_JetTotal" value="0" /> <!-- AdresseTotal + JetMod -->
<input type="hidden" name="attr_EsquiveTotal" value="0" /> <!-- ADTotal + EsquiveMod --->
<input type="hidden" name="attr_FouilleTotal" value="0" /> <!-- IntelligenceTotal + FouilleMod -->
<input type="hidden" name="attr_MagiePhyTotal" value="0" /> <!-- MagiePhys + MagiePhysMod -->
<input type="hidden" name="attr_MagiePsyTotal" value="0" /> <!-- MagiePsy + MagiePsyMod -->
<input type="hidden" name="attr_ResisMagieTotal" value="0" /> <!-- ResisMagie + ResisMagieTotal -->
<input type="hidden" name="attr_materielsCharge" value="0" /> <!-- temp charge du materiel -->
<input type="hidden" name="attr_butinsCharge" value="0" /> <!-- temp charge du butin -->
<input type="hidden" name="attr_livresCharge" value="0" /> <!-- temp charge des livres -->
<input type="hidden" name="attr_bouffesCharge" value="0" /> <!-- temp charge de la bouffe -->

<div class="sheet-wrapper">
	<input type="checkbox" class="display-pnj" name="attr_tab_pnj" value="1" title="Personnage Non Joueur" /><span class="display-pnj"></span>
	<div class="sheet-header">
		<table style="width:100%">
			<tr>
				<th style="width:10%">Nom :</th>
				<td><input type="text" name="attr_CharacterName" class="sheet-noBorder"></td>
				<th style="width:10%">Origine :</th>
				<td><input type="text" name="attr_CharacterOrigin" class="sheet-noBorder"></td>
				<th style="width:10%">Métier(s) :</th>
				<td><input type="text" name="attr_CharacterJobs" class="sheet-noBorder"></td>
			</tr>
			<tr>
				<td>Sexe :</td>
				<td><input type="text" name="attr_CharacterSex" class="sheet-noBorder"></td>
				<td>Âge :</td>
				<td><input type="text" name="attr_CharacterAge" class="sheet-noBorder"></td>
				<td>Taille :</td>
				<td><input type="text" name="attr_CharacterHeight" class="sheet-noBorder"></td>
			</tr>
			<tr>
				<td colspan="6"><input type="checkbox" name="attr_DisplayJet" value="/w gm"> <span class="sheet-hint">Envoyer les jets au MJ uniquement</span></td>
			</tr>
		</table>
	</div>
	<div class="sheet-body sheet-pj">		
		<br />
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_caracteristiques" value="caracteristiques" title="Caractéristiques" checked="checked" /><span class="tab">Caractéristiques</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_competences" value="competences" title="Compétences" /><span class="sheet-tab">Compétences</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_equipement" value="equipement" title="Equipement" /><span class="sheet-tab">Equipement</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_magie" value="magie" title="Compétences" /><span class="sheet-tab">Magie</span>
		<input type="radio" name="attr_tab_nav" class="sheet-tab sheet-tab_inventaire" value="inventaire" title="Inventaire" /><span class="sheet-tab">Inventaire</span>
		<br />
		<br />
		
		<!-- TAB Caractéristiques -->
		<div class="sheet-tab_caracteristiques">
			<div class="sheet-col-float" style="width:360px;">
				<div class="sheet-stats">
					<h2>Caractéristiques</h2>
					<table>
						<thead>
							<tr>
								<th width="130"></th>
								<th width="70">Score</th>
								<th width="70">Mod.</th>
								<th width="70">Épreuve</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<th title="La bravoure du personnage face au danger et à la mort, ainsi que sa rapidité à se décider">Courage</th>

								<td><input type="number" name="attr_Courage" value="0"></td>
								<td><input type="number" name="attr_CourageMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une épreuve de Courage }} {{ Courage=@{CourageTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<th title="La capacité à réfléchir et l'érudition">Intelligence</th>
								<td><input type="number" name="attr_Intelligence" value="0"></td>
								<td><input type="number" name="attr_IntelligenceMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une épreuve d'Intelligence }} {{ Intelligence=@{IntelligenceTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<th title="La beauté physique et la capacité à convaincre les autres">Charisme</th>
								<td><input type="number" name="attr_Charisme" value="0"></td>
								<td><input type="number" name="attr_CharismeMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une épreuve de Charisme}} {{ Charisme=@{CharismeTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<th title="L'agilité, la souplesse et la précision">Adresse</th>
								<td><input type="number" name="attr_Adresse" value="0"></td>
								<td><input type="number" name="attr_AdresseMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une épreuve d'Adresse}} {{ Adresse=@{AdresseTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<th title="La capacité musculaire du personnage, qui influe sur la résistance">Force</th>
								<td><input type="number" name="attr_Force" value="0"></td>
								<td><input type="number" name="attr_ForceMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une épreuve de Force}} {{ Force=@{ForceTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<td colspan="4">&nbsp;</td>
							</tr>
							<tr>
								<th title="Chance de toucher son adversaire">Attaque</th>
								<td><input type="number" name="attr_Attaque" value="8"></td>
								<td><input type="number" name="attr_AttaqueMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une Attaque }} {{ Attaque=@{AttaqueTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<th title="Chance de Parer son adversaire">Parade</th>
								<td><input type="number" name="attr_Parade" value="10"></td>
								<td><input type="number" name="attr_ParadeMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une Parade }} {{ Parade=@{ParadeTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<th title="Chance de toucher avec les armes à distance">Jet</th>
								<td title="Calculée en fonction de l'Adresse"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Jet" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_JetMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une Attaque à distance }} {{ Jet=@{JetTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<th title="Le héros qui esquive va se déplacer rapidement d'environ 2 mètres">Esquive</th>
								<td title="Calculée en fonction de l'adresse, la PR phy et l'encombrement"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Esquive" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_EsquiveMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une Esquive }} {{ Esquive=@{EsquiveTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<th title="Change de trouver des objets / indices">Fouille</th>
								<td title="Calculée en fonction de l'Intelligence"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Fouille" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_FouilleMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} commence à Fouiller }} {{ Fouille=@{FouilleTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<td colspan="4">&nbsp;</td>
							</tr>
							<tr>
								<th tile="Chance de réussir une Magie Physique">Magie Phys.<br><span class="sheet-hint">Moyenne INT et AD</span></th>
								<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_MagiePhy" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_MagiePhyMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} concentre sa Magie}} {{ Magie Phys=@{MagiePhyTotal} }} {{ Résultat=[[1d20]] }} " /></td>
							</tr>
							<tr>
								<th tile="Chance de réussir une Magie Psychique">Magie Psy.<br><span class="sheet-hint">Moyenne INT et CHA</span></th>
								<td tile="Calculée en fonction de l'Int"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_MagiePsy" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_MagiePsyMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} concentre sa Magie }} {{ Magie Psy=@{MagiePhyTotal} }} {{ Résultat=[[1d20]] }}" /></td>
							</tr>
							<tr>
								<th>Résist. Magie<br><span class="sheet-hint">Moyenne COU, INT et FO</span></th>
								<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_ResiMagie" value="0" readonly="readonly"></td>
								<td><input type="number" name="attr_ResiMagieMod" value="0"></td>
								<td style="text-align:center;"><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente de résiter à la Magie}} {{ Résist. Magie=@{ResisMagieTotal} }} {{ Résultat=[[1d20]] }} " /></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div class="sheet-col-float" style="width:160px;">
				<div class="sheet-energie">
					<h2>Energie</h2>
					<table style="margin:auto;">
						<tr>
							<th colspan="3">Energie Vitale (EV) :</th>
						</tr>
						<tr>
							<td><input type="number" name="attr_EV" value="0" step="1"></td>
							<td>/</td>
							<td><input type="number" name="attr_EV_max" value="0" min="1" step="1"></td>
						</tr>
						<tr>
							<th colspan="3">Energie Astrale (EA)</th>
						</tr>
						<tr>
							<td><input type="number" name="attr_EA" value="0" step="1"></td>
							<td>/</td>
							<td><input type="number" name="attr_EA_max" value="0" min="0" step="1"></td>
						</tr>
					</table>
				</div>
				<br />	
				<div class="sheet-xp">
					<div class="sheet-hex sheet-hex-3" style="background-color: #766344; width: 100px; height: 57px">		
						<div class="sheet-inner">
							<h4>Niveau</h4>
							<input type="number" class="sheet-square" name="attr_CharacterLevel" min="1" step="1" value="1"  />
						</div>		
						<div class="sheet-corner-1"></div>
						<div class="sheet-corner-2"></div>		
					</div>					
					<br clear="all" />
					<h2>Expérience (xp)</h2>
					<table style="margin:auto;">
						<tr>
							<td><input type="number" name="attr_CharacterExperience" value="0"></td>		
							<td>/</td>
							<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_CharactErexperience_max" value="100"></td>			
						</tr>
					</table>
					<br />	
					<h2>Points de destin</h2>
					<table style="margin:auto;">
						<tr>
							<td style="text-align:center;"><input type="number" name="attr_CharacterPointDestin" value="0"></td>
						</tr>
					</table>
				</div>
			</div>
			<div class="sheet-col-float" style="width:260px">
				<div class="sheet-sens">
					<h2>Sens</h2>
					<table>
						<tr>
							<th>Langue(s)</th>
							<td><input type="text" class="sheet-noBorder" name="attr_CharacterLangue" value="Commun" /></td>
						</tr>
						<tr>
							<th>Vision</th>
							<td><input type="text" class="sheet-noBorder" name="attr_CharacterVision" value="Standard" /></td>
						</tr>
						<tr>
							<th>Ouïe</th>
							<td><input type="text" class="sheet-noBorder" name="attr_CharacterOuie" value="Standard" /></td>
						</tr>
						<tr>
							<th>Odorat</th>
							<td><input type="text" class="sheet-noBorder" name="attr_CharacterOdorat" value="Standard" /></td>
						</tr>
					</table>					
				</div>
				<br />
				<div class="sheet-sens">
					<h2>Déplacement</h2>
					<table>
						<tr>
							<th>Rapide</th>
							<td title="Calculée en fonction de la PR Phy."><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_DeplacementRapide" value="8" readonly="readonly" /> m / assault</td>
						</tr>
						<tr>
							<th>Durée</th>
							<td title="Calculée en fonction de la Force"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_DeplacementRapideDuree" value="20" readonly="readonly" /> sec</td>
						</tr>
						<tr>
							<th>Sprint (*)</th>
							<td title="Calculée en fonction de la PR Phy."><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_DeplacementSprint" value="12" readonly="readonly" /> m / assault</td>
						</tr>
						<tr>
							<th>Durée</th>
							<td title="Calculée en fonction de la Force"><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_DeplacementSprintDuree" value="5" readonly="readonly" /> sec</td>
						</tr>
					</table>
					<span class="sheet-hint">* Après un assaut en déplacement rapide, on est considéré comme lancé et on peut sprinter.</span>
				</div>				
			</div>
			<br clear="all" />
			<br>
			<span class="sheet-hint" style="display:block" name="attr_BonusIntel"></span>
			<span class="sheet-hint" style="display:block" name="attr_BonusAdresse"></span>
			<span class="sheet-hint" style="display:block" name="attr_BonusForce"></span>
		</div> 
		
		<!-- TAB Compétences --->
		<div class="sheet-tab_competences">
			<div class="sheet-competences">
				<h2>Compétences</h2>
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 236px;">Compétence</div>
					<div class="sheet-col" style="width: 66px;">Épreuve ?</div>
					<div class="sheet-col" style="width: 66px;">Stat.</div>
					<div class="sheet-col" style="width: 86px;">Mod.</div>
					<div class="sheet-col" style="width: 76px;">Épreuve</div>
				</div>
				<fieldset class="repeating_competences">
					<div class="sheet-row">	
						<div class="sheet-col" style="width: 250px;height: 37px">				
							<input type="text" class="sheet-noBorder" name="attr_CompetenceNom" value="" />
						</div>
						<div class="sheet-col" style="width: 330px;">
							<input type="checkbox" class="sheet-display-competenceEpreuve" name="attr_CompetenceEpreuve" value="1" />
							<div class="sheet-display-competenceEpreuve">
								<div class="sheet-col" style="width: 50px;"></div>
								<div class="sheet-col" style="width: 70px;">
									<select name="attr_CompetenceJet">
										<option value="COU : @{CourageTotal}">COU</option>
										<option value="INT : @{IntelligenceTotal}">INT</option>
										<option value="CHA : @{CharismeTotal}">CHA</option>
										<option value="AD : @{AdresseTotal}">AD</option>
										<option value="FO : @{ForceTotal}">FO</option>
									</select>
								</div>
								<div class="sheet-col" style="width: 90px;">
									<input type="number" name="attr_CompetenceMod" value="0" />
								</div>		
								<div class="sheet-col" style="width: 80px;">	
									<button type="roll" value="@{DisplayJet} &{template:default} {{name=Épreuve de @{CompetenceNom} par @{CharacterName} }} {{Épreuve=@{CompetenceJet} + @{CompetenceMod} }} {{ Résultat=[[1d20]] }}"> Épreuve</button>
								</div>
							</div>
						</div>				
					</div>	
				</fieldset>
			</div>
			<br />
			<div class="sheet-coupsspeciaux">			
				<h2>Coups spéciaux</h2>
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 236px;">Coup</div>
					<div class="sheet-col" style="width: 76px;">Stat.</div>
					<div class="sheet-col" style="width: 86px;">Mod.</div>
					<div class="sheet-col" style="width: 86px;">Dégats</div>
					<div class="sheet-col" style="width: 166px;">Jets</div>
				</div>
				<fieldset class="repeating_coupsSpeciaux">
					<div class="sheet-row">	
						<div class="sheet-col" style="width: 250px;">				
							<input type="text" class="sheet-noBorder" name="attr_CoupSpecialNom" value="" />
						</div>
						<div class="sheet-col" style="width: 80px;">
							<select name="attr_CoupSpecialJet">
								<option value="AT : @{AttaqueTotal}">AT</option>
								<option value="AD : @{AdresseTotal}">AD</option>
								<option value="FO : @{ForceTotal}">FO</option>
								<option value="AD/FO : [[ceil((@{ForceTotal}+@{AdresseTotal})/2)]]">AD/FO</option>
							</select>
						</div>
						<div class="sheet-col" style="width: 90px;">
							<input type="number" name="attr_CoupSpecialMod" value="0" />
						</div>		
						<div class="sheet-col" style="width: 90px;">
							<input type="text" class="sheet-shortInput" name="attr_CoupSpecialDegats" value="1d6" />
						</div>		
						<div class="sheet-col" style="width: 270px;">	
							<button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} prépare son coup spécial @{CoupSpecialNom} }} {{ Épreuve=@{CoupSpecialJet} + @{CoupSpecialMod} }} {{ Résultat=[[1d20]] }}" > Épreuve</button>
							<button type="roll" class="sheet-rollDegats" value="@{DisplayJet} &{template:default} {{name=@{CoupSpecialNom} de @{CharacterName} blesse à hauteur de}} {{ Dégats=[[@{CoupSpecialDegats}+@{BonusDegatsForce}]] }}" > Dégats</button>
						</div>
					</div>	
				</fieldset>
			</div>
		</div>
		
		<!-- TAB Equipement --->
		<div class="sheet-tab_equipement">
			<div class="sheet-armes">
				<h2>Armement & Baston</h2>
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 246px;">Arme</div>
					<div class="sheet-col" style="width: 66px;">Portée</div>
					<div class="sheet-col" style="width: 66px;">AT</div>
					<div class="sheet-col" style="width: 66px;">PRD</div>
					<div class="sheet-col" style="width: 66px;">Dégats</div>
					<div class="sheet-col" style="width: 66px;">RUP.</div>
					<div class="sheet-col" style="width: 166px;">Jets</div>
				</div>			
				
				<fieldset class="repeating_armes">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 250px;">
							<input type="text" class="sheet-noBorder" name="attr_ArmeNom" value="" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<select name="attr_armeJet">
								<option value="@{AttaqueTotal}" selected="selected">Mélée</option>
								<option value="@{JetTotal}">Dist.</option>
							</select>
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_ArmeAT" value="0" />
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_ArmePRD" value="0" />							
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="text" class="sheet-shortInput" name="attr_ArmeDegats" value="1d6" />							
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="text" class="sheet-shortInput" name="attr_ArmeRUP" value="" />
						</div>
						<div class="sheet-col" style="width: 180px;">
							<button type="roll" value="@{DisplayJet} &{template:default} {{name=Attaque de @{CharacterName} avec @{ArmeNom} }} {{ AT=@{ArmeJet} + @{ArmeAt} }} {{ Résultat=[[1d20]] }}"> AT </button>
							<button type="roll" value="@{DisplayJet} &{template:default} {{name=Parade de @{CharacterName} avec @{ArmeNom} }} {{ PRD=@{ParadeTotal} + @{ArmePRD} }} {{ Résultat=[[1d20]] }}"> PRD </button>
							<button type="roll" class="sheet-rollDegats" value="@{DisplayJet} &{template:default} {{name=@{ArmeNom} de @{CharacterName} blesse à hauteur de}} {{ Dégats=[[@{ArmeDegats} + @{BonusDegatsForce}]] }}"> Dégats </button>
						</div>
					</div>
				</fieldset>	
				<br>
				<span class="sheet-hint">Le Bonus / Malus aux dégats octroyé par la Force est inclus automatiquement dans les jets de dégats : <span name="attr_BonusDegatsForce"></span></span>
			</div>
			<br />
			<div class="sheet-munitions">
				<input type="checkbox" class="sheet-display display-munitions" name="attr_displayMunitions" value="1" checked="checked" /><h2 class="sheet-display">Munitions</h2>
				<div class="sheet-display-munitions">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 246px;"></div>
						<div class="sheet-col" style="width: 66px;">Nb.</div>
						<div class="sheet-col" style="width: 66px;">Dégats</div>
						<div class="sheet-col" style="width: 66px;">RUP.</div>
					</div>
					<fieldset class="repeating_munitions">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 350px;">
								<input type="text" class="sheet-noBorder" name="attr_MunitionNom" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_MunitionCount" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="text" class="sheet-shortInput" name="attr_MunitionDegats" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="text" class="sheet-shortInput" name="attr_MunitionRUP" value="" />
							</div>
						</div>
					</fieldset>
				</div>
			</div>
			<br />
			<div class="sheet-bagues">
				<input type="checkbox" class="sheet-display display-bagues" name="attr_displayBagues" value="1" checked="checked" /><h2 class="sheet-display">Bagues, Pendentifs, Broches</h2>
				<div class="sheet-display-bagues">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 346px;"></div>
						<div class="sheet-col" style="width: 66px;">Charges</div>
						<div class="sheet-col" style="width: 346px;">Bonus</div>
					</div>	
					<fieldset class="repeating_bagues">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 350px;">
								<input type="text" class="sheet-noBorder" name="attr_BagueNom" value="" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_BagueCount" value="" />
							</div>
							<div class="sheet-col" style="width: 350px;">
								<input type="text" class="sheet-noBorder" name="attr_BagueBonus" value="" />
							</div>
						</div>
					</fieldset>
				</div>
			</div>
			<br />
			<div class="sheet-armor">
				<h2>Armures & Protections</h2>				
				<div class="sheet-col-float" style="width:40%">	
					<div class="sheet-armor-pieces">		
						<table style="margin:auto;">
							<tr>
								<td></td>
								<th style="text-align:center;">Tête</th>
								<td></td>
							</tr>
							<tr>
								<td></td>
								<td style="text-align:center;"><input type="number" class="sheet-square" name="attr_ArmorTete" value="0" /></td>
								<td></td>
							</tr>
							<tr>
								<th style="text-align:center;">Bras</th>
								<th style="text-align:center;">Torse</th>
								<th style="text-align:center;">Bouclier</th>
							</tr>
							<tr>
								<td style="text-align:center;"><input type="number" class="sheet-square" name="attr_ArmorBras" value="0" /></td>
								<td style="text-align:center;"><input type="number" class="sheet-square" name="attr_ArmorTorse" value="0" /></td>
								<td style="text-align:center;"><input type="number" class="sheet-square" name="attr_ArmorBouclier" value="0" /></td>
							</tr>
							<tr>
								<th style="text-align:center;">Jambes</th>
								<td></td>
								<th style="text-align:center;">Pieds</th>
							</tr>
							<tr>
								<td style="text-align:center;"><input type="number" class="sheet-square" name="attr_ArmorJambes" value="0" /></td>
								<td></td>
								<td style="text-align:center;"><input type="number" class="sheet-square" name="attr_ArmorPieds" value="0" /></td>
							</tr>
						</table>
						</div>
					<br />
					<div class="sheet-col-float" style="width:60%;">
						<table>
							<thead>
								<th colspan="2">PR détaillée</th>
							</thead>	
							<tr>
								<th title="Protection par l'Origine ou Compétences - Protège toutes les localisations du corps">PR Naturelle</th>
								<td><input type="number" name="attr_PRNat" value="0" /></td>
							</tr>
							<tr>
								<th title="Protection par l'Armure">PR Physique</th>
								<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_PRPhy" value="0" readonly="readonly" /></td>
							</tr>
							<tr>
								<th title="Protection par la Magie - Protège toutes les localisations du corps">PR Magique</th>
								<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_PRMag" value="0" readonly="readonly" /></td>
							</tr>
							<tr>
								<td colspan="2"><span class="sheet-hint">PR : Valeur de protection</span></td>
							</tr>
						</table>
					</div>
					<div class="sheet-col-float" style="width:30%;">
						<table style="width:100%;">
							<thead>
								<th>PR Totale</th>
							</thead>								
							<tr>
								<td style="text-align:center;"><input type="text" class="sheet-square sheet-autoCalc" name="attr_PR" value="0" readonly="readonly" /></td>								
							</tr>
						</table>
					</div>					
				</div>
				
				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 246px;">Armure</div>
						<div class="sheet-col" style="width: 66px;">PR.</div>
						<div class="sheet-col" style="width: 66px;">PR. Mag.</div>
						<div class="sheet-col" style="width: 66px;">RUP.</div>
					</div>
					<fieldset class="repeating_armures">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 250px;">
								<input type="text" class="sheet-noBorder" name="attr_ArmureNom" value="" />							
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_ArmurePRPhy" value="0" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_ArmurePRMag" value="0" />
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="text" class="sheet-shortInput" name="attr_ArmureRUP" value="" />
							</div>
						</div>
					</fieldset>
				</div>
			</div>
		</div>
				
		<!-- TAB Magie --> 
		<div class="sheet-tab_magie">
			<div class="sheet-col-float" style="width:120px;">
				<div class="sheet-tableth" style="padding: 4px; font-size: 11px;"> v Ecoles / Niveaux > </div>	
				<input type="checkbox" name="attr_EcoleMagieSelectALL" value="1" checked="checked" /><span> Réassigner</span>
				<br /><br />	
				<fieldset class="repeating_EcolesMagie">
					<input type="checkbox" name="attr_EcoleMagieSelected" class="sheet-tab" value="1" /><span class="sheet-tab" name="attr_EcoleMagie">&nbsp;</span>
					<input type="checkbox" name="attr_EcoleMagieModal" class="sheet-modal" value="1" /><span class="sheet-cog">y</span>
					<div class="sheet-modal-wrapper">
						<div class="sheet-modal" style="height:100px;">
							<div class="sheet-modal_header">
								<h2>Ecole de magie : <span class="sheet-close">*</span><input type="checkbox" class="sheet-modal" name="attr_EcoleMagieModal" value="1" /></h2>
							</div>
							<div class="sheet-modal_body" style="text-align:center;">
								<input type="text" class="sheet-noBorder" name="attr_EcoleMagie" value="Généraliste" />
							</div>
						</div>
					</div>
					<br />
					<br />
				</fieldset>
				<br clear="all" />
				<input type="hidden" name="attr_tab_EcoleMagie" class="sheet-tab" value="" />
				<input type="checkbox" name="attr_MagieHowToModal" class="sheet-modal" value="1" /><span class="sheet-cog">?</span> <span class="sheet-hint"> Comment ça marche ?</span>
				<div class="sheet-modal-wrapper">
					<div class="sheet-modal" style="height:300px;">
						<div class="sheet-modal_header">
							<h2>La magie, comment ca marche ? <span class="sheet-close">*</span><input type="checkbox" class="sheet-modal" name="attr_MagieHowToModal" value="1" /></h2>
						</div>
						<div class="sheet-modal_body">
							<b>Avant toute chose :</b><br />
							<ol>
								<li>Commencez par ajouter des écoles de magie dans la colonne de gauche</li>
								<li>Pour renommer une école, cliquez sur la roue dentée en face</li>
							</ol>
							<br />
							<b>Ajouter un sort :</b><br />
							<ol>
								<li>Sélectionnez l'école de magie du sort</li>
								<li>Sélectionnez le niveau du sort</li>
								<li>Ajoutez un sort</li>
								<li>Configurez votre sort, il sera automatiquement associé à l'école et au niveau séléctionnés.</li>
							</ol>
							<br />
							<b>Changer l'école ou le niveau d'un sort :</b><br />
							<ol>
								<li>Cochez la case "Réassigner"</li>
								<li>Sélectionnez l'école et/ou le niveau à changer</li>
								<li>Mettez à jour n'importe quelle information du sort pour que l'école et la magie soient réassigné</li>
							</ol>
						</div>
					</div>
				</div>
			</div>
			<div class="sheet-col-float" style="width:680px; text-align:center;">
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="0" checked="checked" /><span class="sheet-rounded-tab">0</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="1" /><span class="sheet-rounded-tab">1</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="2" /><span class="sheet-rounded-tab">2</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="3" /><span class="sheet-rounded-tab">3</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="4" /><span class="sheet-rounded-tab">4</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="5" /><span class="sheet-rounded-tab">5</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="6" /><span class="sheet-rounded-tab">6</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="7" /><span class="sheet-rounded-tab">7</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="8" /><span class="sheet-rounded-tab">8</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="9" /><span class="sheet-rounded-tab">9</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="10" /><span class="sheet-rounded-tab">10</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="11" /><span class="sheet-rounded-tab">11</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="12" /><span class="sheet-rounded-tab">12</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="13" /><span class="sheet-rounded-tab">13</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="14" /><span class="sheet-rounded-tab">14</span>
				<input type="radio" name="attr_tab_NiveauMagie" class="sheet-rounded-tab" value="15" /><span class="sheet-rounded-tab">15</span>
				<br />
				<br />
			
				<div class="sheet-section sheet-section-sp-list">
					<fieldset class="repeating_Magies">					
						<input type="hidden" class="sheet-hidden" name="attr_MagieEcole" value="" />
						<input type="hidden" class="sheet-hidden" name="attr_MagieNiveau" value="new" />
						<input type="checkbox" class="sheet-hidden sheet-magie-filtre" name="attr_MagieFiltre" checked="checked" value="1" />
						
						<div class="sheet-magie-filtre">
							<div class="sheet-col" style="width: 200px;">
								<input type="text" class="sheet-noBorder" name="attr_MagieNom" value="" />							
							</div>
							<br clear="all" />
							<br />
							<div>
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-incantation"  name="attr_MagieDisplayIncantation" value="1" /> <span class="sheet-display-magie">Incantation</span> 
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-epreuve"  name="attr_MagieDisplayEpreuve" value="1" /> <span class="sheet-display-magie">Épreuves</span> 
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-soins"  name="attr_MagieDisplaySoins" value="1" /> <span class="sheet-display-magie">Soins</span> 
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-degats"  name="attr_MagieDisplayDégats" value="1" /> <span class="sheet-display-magie">Dégats</span> 
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-effet"  name="attr_MagieDisplayEffet" value="1" /> <span class="sheet-display-magie">Effets</span> 
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-ingre"  name="attr_MagieDisplayIngre" value="1" /> <span class="sheet-display-magie">Ingré.</span>
								<input type="checkbox" class="sheet-display-magie sheet-display-magie-creature"  name="attr_MagieDisplayCreature" value="1" /> <span class="sheet-display-magie">Créature</span> 
								<br clear="all" />
								<div class="sheet-display-magie-incantation">
									<br />
									<table width="100%">
										<thead>
											<tr>
												<th>Durée d'incantation</th>
												<th>Durée du sort</th>
												<th>Cout</th>
												<th>Portée</th>
												<th>Aire d'éffet</th>
											</tr>
										</thead>
										<tr>
											<td colspan="5"></td>
										</tr>
										<tr>
											<td style="text-align:center"><input type="text" class="sheet-shortInput" name="attr_MagieIncantation" value="" /></td>
											<td style="text-align:center"><input type="text" class="sheet-shortInput" name="attr_MagieDuree" value="" /></td>
											<td style="text-align:center"><input type="text" class="sheet-shortInput" name="attr_MagieCout" value="" /></td>
											<td style="text-align:center"><input type="text" class="sheet-shortInput" name="attr_MagiePortee" value="" />	</td>
											<td style="text-align:center"><input type="text" class="sheet-shortInput" name="attr_MagieAireEffet" value="" /></td>
										</tr>
									</table>								
								</div>
								<div class="sheet-display-magie-epreuve">
									<br />
									<table width="100%">
										<thead>
											<tr>
												<th style="width:50%; border-right:1px dotted white;" colspan="3">Épreuve Lanceur</th>
												<th style="width:50%" colspan="2">Épreuve Cible</th>
											</tr>
											<tr>
												<th>Stat.</th>
												<th>Mod.</th>
												<th style="border-right:1px dotted white;"></th>
												<th>Stat.</th>
												<th>Mod.</th>
											</tr>										
										</thead>
										<tr>
											<td colspan="5"></td>
										</tr>
										<tr>
											<td style="text-align:center;">
												<select name="attr_MagieEpreuveLanceurJet">
													<option value="" selected="selected"></option>
													<option value="Magie Phys. : @{MagiePhyTotal}">Magie Phys.</option>
													<option value="Magie Psy. : @{MagiePsyTotal}">Magie Psy.</option>
													<option value="INT : @{IntelligenceTotal}">INT</option>
													<option value="COU : @{CourageTotal}">COU</option>
													<option value="CHA : @{CharismeTotal}">CHA</option>
													<option value="AD : @{AdresseTotal}">AD</option>
													<option value="FO : @{ForceTotal}">FO</option>
												</select>
											</td>
											<td style="text-align:center;">
												<input type="text" class="sheet-shortInput" name="attr_MagieEpreuveLanceurMod" value="0" />	
											</td>
											<td style="text-align:center; border-right:1px dotted black;">
												<button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} se concentre pour lancer @{MagieNom} }} {{ Épreuve=@{magieEpreuveLanceurJet} + [[@{magieEpreuveLanceurMod}]] }} {{ Résultat = [[1d20]] }}"> Épreuve </button>
											</td>
											<td style="text-align:center;">
												<select name="attr_MagieEpreuveCibleJet">
													<option value="" selected="selected"></option>
													<option value="Resits. Magie">Résist. Magie</option>
													<option value="Magie Phys.">Magie Phys.</option>
													<option value="Magie Psy.">Magie Psy.</option>
													<option value="INT">INT</option>
													<option value="COU">COU</option>
													<option value="CHA">CHA</option>
													<option value="AD">AD</option>
													<option value="FO">FO</option>
												</select>
											</td>
											<td style="text-align:center;">
												<input type="text" class="sheet-shortInput" name="attr_MagieEpreuveCibleMod" value="" />
											</td>
										</tr>
									</table>
								</div>
								<div class="sheet-display-magie-soins">
									<br />
									<table width="100%">
									<thead>
										<tr>
											<th>Montant des soins</th>
										</tr>
									</thead>
									<tr>
										<td style="text-align:center;">
											<input type="text" class="sheet-shortInput" name="attr_MagieSoin" value="1d6" />
											<button type="roll" class="sheet-rollDegats" value="@{DisplayJet} &{template:default} {{name=@{MagieNom} de @{CharacterName} soigne à hauteur de }} {{EV = [[@{MagieSoin}]] }}"> Soigner </button>
										</td>
									</tr>
									</table>
								</div>
								<div class="sheet-display-magie-degats">
									<br />
									<table width="100%">
									<thead>
										<tr>
											<th style="width:15%">Bonus d'intel ?</th>
											<th>Montant des dégats</th>
										</tr>
									</thead>
									<tr>
										<td style="text-align:center;">
											<input type="checkbox" name="attr_MagieBonusInt" value="@{bonusDegatsIntel}" />
										</td>
										<td style="text-align:center;">
											<input type="text" class="sheet-shortInput" name="attr_MagieDegats" value="1d6" />
											<button type="roll" class="sheet-rollDegats" value="@{DisplayJet} &{template:default} {{name=@{MagieNom} de @{CharacterName} blesse à hauteur de }} {{EV = [[@{magieDegats} + @{magieBonusInt}]]  }}"> Dégats </button>
										</td>
									</tr>
									</table>
								</div>
								<div class="sheet-display-magie-effet">
									<br />
									Effets :
									<textarea name="attr_MagieEffet"></textarea>
								</div>
								<div class="sheet-display-magie-ingre">
									<br />
									Ingrédients :
									<textarea name="attr_MagieIngre"></textarea>
								</div>
								<div class="sheet-display-magie-creature">
									<br />
									<table width="100%">
										<tr>
											<th>Énergie vitale</th>
											<td><input type="number" class="sheet-shortInput" name="attr_CreatureEV" value="" /></td>
											<th>INT</th>
											<td><input type="number" class="sheet-shortInput" name="attr_CreatureINT" value="" /></td>
										</tr>
										<tr>
											<th>AT</th>
											<td><input type="number" class="sheet-shortInput" name="attr_CreatureAT" value="" /></td>
											<th>PRD / Esquive</th>
											<td><input type="number" class="sheet-shortInput" name="attr_CreatureDEF" value="" /></td>
										</tr>
										<tr>
											<th>COU</th>
											<td><input type="number" class="sheet-shortInput" name="attr_CreatureCOU" value="" /></td>
											<th>PR</th>
											<td><input type="number" class="sheet-shortInput" name="attr_CreaturePR" value="" /></td>
										</tr>
										<tr>
											<th>Classe/XP</th>
											<td><input type="number" class="sheet-shortInput" name="attr_CreatureXP" value="" /></td>
											<th>Résist. Magie</th>
											<td><input type="number" class="sheet-shortInput" name="attr_CreatureResiMagie" value="" /></td>
										</tr>
										<tr>
											<th>Dégâts</th>
											<td colspan="3">
												<input type="text" class="sheet-shortInput" name="attr_CreatureDegats" value="1d6" />
												<button type="roll" class="sheet-rollDegats" value="@{DisplayJet} &{template:default} {{name=Attaque de @{MagieNom}, invoqué par @{CharacterName} }} {{ Dégats = [[@{CreatureDegats}]] }}"> Dégats </button>
											</td>
										</tr>
									</table>
									<br />
									<table width="100%">
										<thead>
											<tr>
												<th style="width:33%; border-right:1px dotted white;">Épreuve d'Appel</th>
												<th style="width:33%; border-right:1px dotted white;">Épreuve de Contrôle</th>
												<th style="width:33%">Épreuve de Révocation</th>
											</tr>
										</thead>
										<tr>
											<td colspan="3"></td>
										</tr>
										<tr>
											<td style="text-align:center; border-right:1px dotted black;">
												Magie Psy.
												<input type="number" name="attr_MagieEpreuveAppelMod" value="0" />	
												<button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente d'appeler @{MagieNom} }} {{Épreuve=@{MagiePsyTotal} + [[@{magieEpreuveAppelMod}]] }} {{ Résultat = [[1d20]] }}"> Épreuve </button>
											</td>
											<td style="text-align:center; border-right:1px dotted black;">
												Magie Psy.
												<input type="text" class="sheet-shortInput" name="attr_MagieEpreuveControlMod" value="2D6" />	
												<button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente de controler @{MagieNom} }} {{ Épreuve=@{MagiePsyTotal} + [[@{magieEpreuveControlMod}]] }} {{ Résultat = [[1d20]] }}"> Épreuve </button>
												<br />
												<span class="sheet-hint">Cible : 2D6 + Résist. Magie</span>
											</td>
											<td style="text-align:center;">
												Magie Psy.
												<input type="text" class="sheet-shortInput" name="attr_MagieEpreuveRevocationMod" value="3D6" />	
												<button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente de révoquer @{MagieNom} }} {{ Épreuve=@{MagiePsyTotal} + [[@{magieEpreuveRevocationMod}]] }} {{ Résultat = [[1d20]] }}"> Épreuve </button>
												<br />
												<span class="sheet-hint">Cible : 3D6 + Résist. Magie</span>
											</td>
										</tr>
									</table>
								</div>
							</div>
						</div>
					</fieldset>
				</div>
				<br clear="all" />
			</div>
		</div>
		
		<!-- TAB Inventaire --> 
		<div class="sheet-tab_inventaire">
			<div class="sheet-col-float">
				<h2>Mes richesses</h2>
				<table>
					<tr>
						<th>Pièces d'Or</th>
						<td><input type="number" name="attr_RichesseOr" value="0" /></td>
					</tr>
					<tr>
						<th>Pièces d'Argent</th>
						<td><input type="number" name="attr_RichesseArgent" value="0" /></td>
					</tr>
					<tr>
						<th>Pièces de Cuivre</th>
						<td><input type="number" name="attr_RichesseCuivre" value="0" /></td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th>Lingots de Berylium</th>
						<td><input type="number" name="attr_RichesseBerylium" value="0" /></td>
					</tr>
					<tr>
						<th>Lingots de Thritil</th>
						<td><input type="number" name="attr_RichesseThritil" value="0" /></td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th>Billets 10</th>
						<td><input type="number" name="attr_RichesseBillet10" value="0" /></td>
					</tr>
					<tr>
						<th>Billets 50</th>
						<td><input type="number" name="attr_RichesseBillet50" value="0" /></td>
					</tr>
					<tr>
						<th>Billets 100</th>
						<td><input type="number" name="attr_RichesseBillet100" value="0" /></td>
					</tr>
					<tr>
						<th>Billets 500</th>
						<td><input type="number" name="attr_RichesseBillet500" value="0" /></td>
					</tr>
					<tr>
						<th>Billets 1000</th>
						<td><input type="number" name="attr_RichesseBillet1000" value="0" /></td>
					</tr>
				</table>
			</div>
			<div class="sheet-col-float">
				<h2>Bivouac & Camping</h2>
				<table>
					<thead>

						<tr>
							<td></td>
							<th style="width:70px;">Récup.</th>
							<th style="width:70px;">Poids</th>
						</tr>
					</thead>
					<tr>
						<td><input type="text" class="sheet-noBorder" name="attr_Couverture" value="Couverture" /></td>
						<td><input type="text" class="sheet-shortInput" name="attr_CouvertureRecup" value="" /></td>						
						<td><input type="number" name="attr_CouverturePoids" value="0" /></td>						
					</tr>
					<tr>
						<td><input type="text" class="sheet-noBorder" name="attr_Matelas" value="Matelas" /></td>
						<td><input type="text" class="sheet-shortInput" name="attr_MatelasRecup" value="" /></td>
						<td><input type="number"  name="attr_MatelasPoids" value="0" /></td>
					</tr>
					<tr>
						<td><input type="text" class="sheet-noBorder" name="attr_Tente" value="Tente" /></td>
						<td><input type="text" class="sheet-shortInput" name="attr_TenteRecup" value="" /></td>
						<td><input type="number" name="attr_TentePoids" value="0" /></td>
					</tr>
					<tr>
						<td></td>
						<td style="text-align:center"><span class="sheet-hint">EV / H</span></td>
						<td style="text-align:center"><span class="sheet-hint">KG</span></td>
					</tr>
				</table>
			</div>
			
			<div class="sheet-col-float">
				<h2>Encombrement</h2>
				<table>
					<tr>
						<th title="Selon Origine du personnage">Charge max</th>
						<td><input type="text" class="sheet-shortInput" name="attr_CharacterCharge_max" value="0" /> </td>
						<td colspan="2">Kg</td>
					</tr>
					<tr>
						<th>Bourses</th>
						<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_BoursesCharge" value="0" readonly="readonly" /></td>
						<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_BoursesCharge_max" value="0" readonly="readonly" /></td>
						<td>Pièces</td>
					</tr>
					<tr>
						<th>Sacs</th>
						<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_SacsCharge" value="0" readonly="readonly" /></td>
						<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_SacsCharge_max" value="0" readonly="readonly" /> </td>
						<td>Kg</td>
					</tr>
					<tr>
						<td colspan="4">
							  <input type="radio" value="0" name="attr_charSurcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-0" checked>
							  <input type="radio" value="1" name="attr_charSurcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-1">
							  <input type="radio" value="2" name="attr_charSurcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-2">
							  <input type="radio" value="3" name="attr_charSurcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-3">
							  <input type="radio" value="4" name="attr_charSurcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-4">
							  <input type="radio" value="5" name="attr_charSurcharge" class="sheet-hidden sheet-overweight-checkbox sheet-overweight-5">
							  <div class="sheet-overweight">
							  </div>
						</td>
					</tr>
				</table>
			</div>

			<div class="sheet-col-float">
				<br />
				<h2>Sacs & Bourses</h2>
				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 190px;">Sacs</div>
						<div class="sheet-col" style="width: 66px;">Poids max</div>
					</div>
					<fieldset class="repeating_sacs">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 190px;">
								<input type="text" class="sheet-noBorder" name="attr_sacNom" value="" />							
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_sacCharge_max" value="0" />
							</div>
						</div>
					</fieldset>
				</div>
				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 180px;">Bourses</div>
						<div class="sheet-col" style="width: 80px;">Pièces max</div>
					</div>
					<fieldset class="repeating_bourses">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 190px;">
								<input type="text" class="sheet-noBorder" name="attr_bourseNom" value="" />							
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_bourseCharge_max" value="0" />
							</div>
						</div>
					</fieldset>
				</div>
			</div>
			
			<br clear="all" />
			<br />	
						
			<input type="radio" class="sheet-tab sheet-tab_materiel" name="attr_displayInventaire" value="Matériel" checked="checked" /><span class="sheet-tab">Matériel</span>
			<input type="radio" class="sheet-tab sheet-tab_butin" name="attr_displayInventaire" value="Butins" /><span class="sheet-tab">Butins</span>
			<input type="radio" class="sheet-tab sheet-tab_divers" name="attr_displayInventaire" value="Divers" title="Bouffe, Boissons, Gemmes, Objets de quête, Livres" /><span class="sheet-tab">Divers</span>
			<input type="radio" class="sheet-tab sheet-tab_conso" name="attr_displayInventaire" value="Potions" title="Potions / Poisons / Antidotes" /><span class="sheet-tab">Potions</span>
			<input type="radio" class="sheet-tab sheet-tab_ingre" name="attr_displayInventaire" value="Ingrédients" /><span class="sheet-tab">Ingrédients</span>
			<input type="radio" class="sheet-tab sheet-tab_reliques" name="attr_displayInventaire" value="Spéciaux" title="Objets spéciaux, Maudits, Reliques" /><span class="sheet-tab">Objets spéciaux</span>
			
			<br clear="all" />
			<br />

			<div class="sheet-tab_materiel">
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 315px;">Matériel</div>
					<div class="sheet-col" style="width: 70px;">Poids</div>
					<div class="sheet-col" style="width: 315px;"></div>
					<div class="sheet-col" style="width: 70px;">Poids</div>
				</div>
				<fieldset class="repeating_materiels">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 320px;">
							<input type="text" class="sheet-noBorder" name="attr_MaterielNom" value="" />							
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_MaterielPoids" value="0" />							
						</div>
					</div>
				</fieldset>
			</div>			
			
			<div class="sheet-tab_butin">
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 315px;">Butins</div>
					<div class="sheet-col" style="width: 70px;">Poids</div>
					<div class="sheet-col" style="width: 315px;"></div>
					<div class="sheet-col" style="width: 70px;">Poids</div>
				</div>
				<fieldset class="repeating_butins">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 320px;">
							<input type="text" class="sheet-noBorder" name="attr_ButinNom" value="" />							
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_ButinPoids" value="0" />							
						</div>
					</div>
				</fieldset>
			</div>
							
			<div class="sheet-tab_divers">			
				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 315px;">Bouffe & Boisson</div>
						<div class="sheet-col" style="width: 70px;">Poids</div>
					</div>
					<fieldset class="repeating_bouffes">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 320px;">
								<input type="text" class="sheet-noBorder" name="attr_BouffeNom" value="" />							
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_BouffePoids" value="0" />							
							</div>
						</div>
					</fieldset>
				</div>
					
				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 315px;">Gemmes</div>
						<div class="sheet-col" style="width: 70px;">U.G</div>
					</div>
					<fieldset class="repeating_gemmes">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 320px;">
								<input type="text" class="sheet-noBorder" name="attr_GemmeNom" value="" />							
							</div>
							<div class="sheet-col" style="width: 70px;">
								<input type="number" name="attr_GemmeUG" value="" />							
							</div>
						</div>
					</fieldset>
				</div>
				
				<br clear="all">
				<br />
				
				<div class="sheet-col-float">
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 393px;">Objets de Quête</div>
					</div>
					<fieldset class="repeating_quetes">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 393px;">
								<input type="text" class="sheet-noBorder" name="attr_QueteNom" value="" />							
							</div>
						</div>
					</fieldset>
				</div>
				
				<div class="sheet-col-float">			
					<div class="sheet-tableth">
						<div class="sheet-col" style="width: 393px;">Livres (500 gr)</div>
					</div>
					<fieldset class="repeating_livres">
						<div class="sheet-row">
							<div class="sheet-col" style="width: 393px;">
								<input type="text" class="sheet-noBorder" name="attr_LivreNom" value="" />							
							</div>
						</div>
					</fieldset>
				</div>
			</div>
	
			<div class="sheet-tab_conso">
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 366px;">Potions</div>
					<div class="sheet-col" style="width: 70px;">Doses</div>
					<div class="sheet-col" style="width: 366px;">Effets</div>
				</div>
				<fieldset class="repeating_potions">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_ConsoNom" value="" />							
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_ConsoCount" value="0" />							
						</div>
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_ConsoEffet" value="" />							
						</div>
					</div>
				</fieldset> 

				<br clear="all"	 />
				<br />
				
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 366px;">Poisons</div>
					<div class="sheet-col" style="width: 70px;">Doses</div>
					<div class="sheet-col" style="width: 366px;">Effets</div>
				</div>
				<fieldset class="repeating_poisons">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_ConsoNom" value="" />							
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_ConsoCount" value="0" />							
						</div>
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_ConsoEffet" value="" />							
						</div>
					</div>
				</fieldset> 
				
				<br clear="all"	 />
				<br />

				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 366px;">Antidotes</div>
					<div class="sheet-col" style="width: 70px;">Doses</div>
					<div class="sheet-col" style="width: 366px;">Effets</div>
				</div>
				<fieldset class="repeating_antidotes">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_ConsoNom" value="" />							
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_ConsoCount" value="0" />
						</div>
						<div class="sheet-col" style="width: 370px;">
							<input type="text" class="sheet-noBorder" name="attr_ConsoEffet" value="" />							
						</div>
					</div>
				</fieldset> 
			</div>

			<div class="sheet-tab_ingre">
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 315px;">Ingrédients</div>
					<div class="sheet-col" style="width: 70px;">NB</div>
					<div class="sheet-col" style="width: 315px;"></div>
					<div class="sheet-col" style="width: 70px;">NB</div>
				</div>
				<fieldset class="repeating_ingre">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 320px;">
							<input type="text" class="sheet-noBorder" name="attr_IngreNom" value="" />							
						</div>
						<div class="sheet-col" style="width: 70px;">
							<input type="number" name="attr_ConsoCount" value="0" />							
						</div>
					</div>
				</fieldset> 
			</div>

			<div class="sheet-tab_reliques">
				<div class="sheet-tableth">
					<div class="sheet-col" style="width: 350px;">Objets spéciaux, Maudits, Reliques</div>
					<div class="sheet-col" style="width: 460px;">Effets</div>
				</div>
				<fieldset class="repeating_reliques">
					<div class="sheet-row">
						<div class="sheet-col" style="width: 350px;">
							<input type="text" class="sheet-noBorder" name="attr_ReliqueNom" value="" />							
						</div>
						<div class="sheet-col" style="width: 460px;">
							<input type="text" class="sheet-noBorder" name="attr_ReliqueEffet" value="" />							
						</div>
					</div>
				</fieldset> 
			</div>
			<br clear="all">
		</div>	
	</div>	
	<div class="sheet-body sheet-pnj">
		<br clear="all" />
		<h2>Caractéristiques</h2>
		<table style="width:100%">
			<thead>
				<tr>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une épreuve de Courage }} {{ Courage=@{CourageTotal} }} {{ Résultat=[[1d20]] }}"> COU</button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une épreuve d'Intelligence }} {{ Intelligence=@{IntelligenceTotal} }} {{ Résultat=[[1d20]] }}"> INT</button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une épreuve de Charisme}} {{ Charisme=@{CharismeTotal} }} {{ Résultat=[[1d20]] }}"> CHA</button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une épreuve d'Adresse}} {{ Adresse=@{AdresseTotal} }} {{ Résultat=[[1d20]] }}"> AD</button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une épreuve de Force}} {{ Force=@{ForceTotal} }} {{ Résultat=[[1d20]] }}"> FO</button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une Attaque }} {{ Attaque=@{AttaqueTotal} }} {{ Résultat=[[1d20]] }}"> <b>AT</b></button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une Parade }} {{ Parade=@{ParadeTotal} }} {{ Résultat=[[1d20]] }}"> PRD</button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une Attaque à distance }} {{ Jet=@{JetTotal} }} {{ Résultat=[[1d20]] }}"> JET</button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente une Esquive }} {{ Esquive=@{EsquiveTotal} }} {{ Résultat=[[1d20]] }}"> ESQ</button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} concentre sa Magie}} {{ Magie Phys=@{MagiePhyTotal} }} {{ Résultat=[[1d20]] }} "> MPhy</button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} concentre sa Magie }} {{ Magie Psy=@{MagiePhyTotal} }} {{ Résultat=[[1d20]] }}"> MPsy</button></th>
					<th><button type="roll" value="@{DisplayJet} &{template:default} {{name=@{CharacterName} tente de résiter à la Magie}} {{ Résist. Magie=@{ResisMagieTotal} }} {{ Résultat=[[1d20]] }} "> RM</button></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><input type="number" name="attr_Courage" value="0"></td>
					<td><input type="number" name="attr_Intelligence" value="0"></td>
					<td><input type="number" name="attr_Charisme" value="0"></td>
					<td><input type="number" name="attr_Adresse" value="0"></td>
					<td><input type="number" name="attr_Force" value="0"></td>
					<td><input type="number" name="attr_Attaque" value="8"></td>
					<td><input type="number" name="attr_Parade" value="10"></td>
					<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Jet" value="0" readonly="readonly"></td>
					<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_Esquive" value="0" readonly="readonly"></td>
					<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_MagiePhy" value="0" readonly="readonly"></td>
					<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_MagiePsy" value="0" readonly="readonly"></td>
					<td><input type="text" class="sheet-shortInput sheet-autoCalc" name="attr_ResiMagie" value="0" readonly="readonly"></td>
				</tr>
			</tbody>
		</table>
		<br />
		<div class="sheet-col-float">
			<table>
				<thead>
					<tr>
						<th colspan="3">Energie Vitale (EV) :</th>
					</tr>
				</thead>
				<tr>
					<td><input type="number" name="attr_EV" value="0" step="1"></td>
					<td>/</td>
					<td><input type="number" name="attr_EV_max" value="0" min="1" step="1"></td>
				</tr>
			</table>
		</div>
		<div class="sheet-col-float">
			<table>
				<thead>
					<tr>
						<th colspan="3">Energie Astrale (EA)</th>
					</tr>
				</thead>
				</tr>
					<td><input type="number" name="attr_EA" value="0" step="1"></td>
					<td>/</td>
					<td><input type="number" name="attr_EA_max" value="0" min="0" step="1"></td>
				</tr>
			</table>
		</div>
		<div class="sheet-col-float">
			<table>
				<thead>
					<tr>
						<th>Niveau</th>
					</tr>
				</thead>
				</tr>
					<td><input type="number" name="attr_CharacterLevel" value="0" step="1"></td>
				</tr>
			</table>
		</div>
		<div class="sheet-col-float">
			<table>
				<thead>
					<tr>
						<th>XP</th>
					</tr>
				</thead>
				</tr>
					<td><input type="number" name="attr_CharacterExperience" value="0" step="1"></td>
				</tr>
			</table>
		</div>
		<br clear="all" />
		<br />
		<div class="sheet-armes">
			<h2>Armement & Baston</h2>
			<div class="sheet-tableth">
				<div class="sheet-col" style="width: 246px;">Arme</div>
				<div class="sheet-col" style="width: 66px;">Portée</div>
				<div class="sheet-col" style="width: 66px;">AT</div>
				<div class="sheet-col" style="width: 66px;">PRD</div>
				<div class="sheet-col" style="width: 66px;">Dégats</div>
				<div class="sheet-col" style="width: 66px;">RUP.</div>
				<div class="sheet-col" style="width: 166px;">Jets</div>
			</div>			
			
			<fieldset class="repeating_PNJarmes">
				<div class="sheet-row">
					<div class="sheet-col" style="width: 250px;">
						<input type="text" class="sheet-noBorder" name="attr_ArmeNom" value="" />
					</div>
					<div class="sheet-col" style="width: 70px;">
						<select name="attr_armeJet">
							<option value="@{AttaqueTotal}" selected="selected">Mélée</option>
							<option value="@{JetTotal}">Dist.</option>
						</select>
					</div>
					<div class="sheet-col" style="width: 70px;">
						<input type="number" name="attr_ArmeAT" value="0" />
					</div>
					<div class="sheet-col" style="width: 70px;">
						<input type="number" name="attr_ArmePRD" value="0" />							
					</div>
					<div class="sheet-col" style="width: 70px;">
						<input type="text" class="sheet-shortInput" name="attr_ArmeDegats" value="1d6" />							
					</div>
					<div class="sheet-col" style="width: 70px;">
						<input type="text" class="sheet-shortInput" name="attr_ArmeRUP" value="" />
					</div>
					<div class="sheet-col" style="width: 180px;">
						<button type="roll" value="@{DisplayJet} &{template:default} {{name=Attaque de @{CharacterName} avec @{ArmeNom} }} {{ AT=@{ArmeJet} + @{ArmeAt} }} {{ Résultat=[[1d20]] }}"> AT </button>
						<button type="roll" value="@{DisplayJet} &{template:default} {{name=Parade de @{CharacterName} avec @{ArmeNom} }} {{ PRD=@{ParadeTotal} + @{ArmePRD} }} {{ Résultat=[[1d20]] }}"> PRD </button>
						<button type="roll" class="sheet-rollDegats" value="@{DisplayJet} &{template:default} {{name=@{ArmeNom} de @{CharacterName} blesse à hauteur de}} {{ Dégats=[[@{ArmeDegats} + @{BonusDegatsForce}]] }}"> Dégats </button>
					</div>
				</div>
			</fieldset>	
		</div>
		<br clear="all" />
		<br />
		<div class="sheet-armor">
			<h2>Armures & Protections</h2>	
			<div class="sheet-col-float" style="width:48%;">
				<table style="width:100%">
					<thead>
						<tr>
							<th style="text-align:center;">Tête</th>
							<th style="text-align:center;">Bras</th>
							<th style="text-align:center;">Torse</th>
							<th style="text-align:center;">Jambes</th>
							<th style="text-align:center;">Pieds</th>
							<th style="text-align:center;">Bouclier</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td style="text-align:center;"><input type="number" name="attr_ArmorTete" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_ArmorBras" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_ArmorTorse" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_ArmorJambes" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_ArmorPieds" value="0" /></td>
							<td style="text-align:center;"><input type="number" name="attr_ArmorBouclier" value="0" /></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="sheet-col-float" style="width:48%;">
				<table style="width:100%; text-align:center;">
					<thead>
						<th>PR Naturelle</th>
						<th>PR Physique</th>
						<th>PR Magique</th>
						<th>PR Totale</th>
					</thead>	
					<tr>
						<td style="text-align:center;"><input type="number" name="attr_PRNat" value="0" /></td>
						<td style="text-align:center;"><input type="number" name="attr_PRPhy" value="0" /></td>
						<td style="text-align:center;"><input type="number" name="attr_PRMag" value="0" /></td>
						<td style="text-align:center;"><input type="number" name="attr_PR" value="0" /></td>								
					</tr>
				</table>
			</div>
		</div>
		<br clear="all" />
		<br />
		<div class="sheet-butins">
			<h2>Butins</h2>
			<textarea name="attr_CharacterButins"></textarea>
		</div>
	</div>
</div>